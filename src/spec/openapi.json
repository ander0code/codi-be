{
  "openapi": "3.0.0",
  "info": {
    "title": "Codi API",
    "description": "API",
    "version": "1.0.0",
    "contact": {
      "name": "API Support",
      "email": "support@example.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Development server"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/test": {
      "get": {
        "summary": "Obtener mensaje de prueba",
        "description": "Endpoint de prueba simple",
        "tags": [
          "Test"
        ],
        "responses": {
          "200": {
            "description": "Respuesta exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Test endpoint working"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "message": {
                          "type": "string",
                          "example": "Hello World"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/test/echo": {
      "post": {
        "summary": "Echo de datos",
        "description": "Devuelve los datos enviados",
        "tags": [
          "Test"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TestEchoInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Echo exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Echo successful"
                    },
                    "data": {
                      "$ref": "#/components/schemas/TestEchoResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "summary": "Registrar un nuevo usuario",
        "description": "Crea una nueva cuenta de usuario y devuelve los datos del usuario junto con un token JWT de autenticaci√≥n.",
        "tags": [
          "Auth - Tradicional"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRegisterInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Registro exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Usuario registrado exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuthResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Correo ya registrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Iniciar sesi√≥n",
        "description": "Autentica a un usuario con su correo y contrase√±a.",
        "tags": [
          "Auth - Tradicional"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthLoginInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inicio de sesi√≥n exitoso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Inicio de sesi√≥n exitoso"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuthResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Credenciales inv√°lidas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/refresh-token": {
      "post": {
        "summary": "Refrescar token de acceso",
        "description": "Obtiene un nuevo par de tokens utilizando un refresh token v√°lido.",
        "tags": [
          "Auth - Tradicional"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRefreshTokenInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refrescado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Token refrescado exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuthResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Refresh token inv√°lido",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/google": {
      "post": {
        "summary": "üÜï Login con Google (Aplicaci√≥n M√≥vil)",
        "description": "**NUEVO ENDPOINT PARA M√ìVIL:** Autentica usuarios de aplicaciones m√≥viles (Android/iOS) usando el idToken de Google.\n\n## üì± Flujo para Aplicaci√≥n M√≥vil\n\n### Paso 1: Configurar Google Sign-In en la App\n**Android (Kotlin/Java):**\n```kotlin\nval gso = GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)\n    .requestIdToken(\"TU_WEB_CLIENT_ID.apps.googleusercontent.com\")\n    .requestEmail()\n    .build()\n\nval googleSignInClient = GoogleSignIn.getClient(this, gso)\n```\n\n**iOS (Swift):**\n```swift\nGIDSignIn.sharedInstance.signIn(with: signInConfig, presenting: self) { user, error in\n    let idToken = user?.authentication.idToken\n}\n```\n\n### Paso 2: Obtener idToken de Google SDK\n```kotlin\n// Android\nval account = GoogleSignIn.getSignedInAccountFromIntent(data).result\nval idToken = account.idToken // Este es el token que debes enviar\n```\n\n### Paso 3: Enviar idToken al Backend\n```kotlin\nval response = api.loginWithGoogle(\n    GoogleLoginRequest(idToken = idToken)\n)\n```\n\n### Paso 4: Guardar Tokens JWT\n```kotlin\nval jwt = response.data.token\nval refreshToken = response.data.refreshToken\n\n// Guardar en SecureStorage\nsecurePrefs.saveToken(jwt)\nsecurePrefs.saveRefreshToken(refreshToken)\n```\n\n## ‚ö†Ô∏è Importante\n- **NO env√≠es el Client ID**: El backend ya tiene configurado su Web Client ID\n- **El idToken debe estar firmado por Google**: El backend lo verificar√°\n- **El idToken expira en ~1 hora**: √ösalo inmediatamente despu√©s de obtenerlo\n- **Diferencia con Web**: En web usas `/auth/signin?provider=google` (redirect), en m√≥vil usas este endpoint (JSON)",
        "tags": [
          "Auth - OAuth M√≥vil"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GoogleLoginInput"
              },
              "examples": {
                "android_example": {
                  "summary": "Ejemplo desde Android",
                  "description": "idToken obtenido del Google Sign-In SDK para Android",
                  "value": {
                    "idToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjU5MmU0YmZlN2RkYWFmMGNmZjRhMTJhMjk0ODFkZjJlOGQ2MTU0YzMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI4MDgyOTc5NTgyLTk0MzA5OGJvYWhhZzc5dXZxNzM3ZWY5dmJyNWc1aWE4LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiODA4Mjk3OTU4Mi05NDMwOThib2FoYWc3OXV2cTczN2VmOXZicjVnNWlhOC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwNzk2NDIzNDgyMTk0NjE1MTU5MiIsImVtYWlsIjoiZXhhbXBsZUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkpvaG4gRG9lIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hLS9BT2gxNEdnNl9fVGdQQV96QVlyYy1zSDFXT2h4N2V0eHN4elRlY1p0VjlaRT1zOTYtYyIsImdpdmVuX25hbWUiOiJKb2huIiwiZmFtaWx5X25hbWUiOiJEb2UiLCJsb2NhbGUiOiJlbiIsImlhdCI6MTcxNjIzOTAyMiwiZXhwIjoxNzE2MjQyNjIyfQ.example_signature"
                  }
                },
                "ios_example": {
                  "summary": "Ejemplo desde iOS",
                  "description": "idToken obtenido del Google Sign-In SDK para iOS",
                  "value": {
                    "idToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjU5MmU0YmZlN2RkYWFmMGNmZjRhMTJhMjk0ODFkZjJlOGQ2MTU0YzMiLCJ0eXAiOiJKV1QifQ..."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Autenticaci√≥n exitosa con Google",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Inicio de sesi√≥n exitoso con Google"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuthResponse"
                    }
                  }
                },
                "examples": {
                  "successful_mobile_login": {
                    "summary": "Login exitoso desde m√≥vil",
                    "value": {
                      "success": true,
                      "message": "Inicio de sesi√≥n exitoso con Google",
                      "data": {
                        "user": {
                          "id": "550e8400-e29b-41d4-a716-446655440000",
                          "nombre": "Juan",
                          "apellido": "P√©rez",
                          "email": "juan.perez@gmail.com",
                          "proveedorAuth": "google"
                        },
                        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCIsImVtYWlsIjoianVhbi5wZXJlekBnbWFpbC5jb20iLCJub21icmUiOiJKdWFuIiwiYXBlbGxpZG8iOiJQw6lyZXoiLCJpYXQiOjE3MTYyMzkwMjIsImV4cCI6MTcxNjg0MzgyMn0.example_signature",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCIsImVtYWlsIjoianVhbi5wZXJlekBnbWFpbC5jb20iLCJub21icmUiOiJKdWFuIiwiYXBlbGxpZG8iOiJQw6lyZXoiLCJpYXQiOjE3MTYyMzkwMjIsImV4cCI6MTcxODgzMTAyMn0.example_signature"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n - idToken no proporcionado o inv√°lido",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "missing_token": {
                    "summary": "idToken faltante",
                    "value": {
                      "success": false,
                      "message": "El idToken de Google es requerido"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token de Google inv√°lido o expirado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "invalid_token": {
                    "summary": "Token inv√°lido",
                    "value": {
                      "success": false,
                      "message": "Token de Google inv√°lido o expirado"
                    }
                  },
                  "expired_token": {
                    "summary": "Token expirado",
                    "value": {
                      "success": false,
                      "message": "Token de Google inv√°lido o expirado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error interno del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/oauth/success": {
      "get": {
        "summary": "‚úÖ Obtener tokens despu√©s de OAuth (Web)",
        "description": "**ENDPOINT PARA WEB:** Despu√©s de que el usuario se autentica con Google en navegador web, este endpoint devuelve un JSON con los datos del usuario, token JWT y refresh token.\n\n**Flujo Web:**\n1. Usuario hace clic en bot√≥n de Google (web)\n2. Se abre popup con `/auth/signin?provider=google`\n3. Usuario autoriza en Google\n4. Google redirige a `/auth/callback/google`\n5. Auth.js procesa y redirige a `/auth/oauth/success`\n6. Frontend hace `fetch()` a este endpoint para obtener los tokens\n\n**‚ö†Ô∏è Importante:** Este endpoint solo funciona inmediatamente despu√©s del flujo OAuth web. Los datos se limpian despu√©s de la primera petici√≥n.\n\n**üÜö Diferencia con `/auth/google`:**\n- `/auth/oauth/success`: Para **navegador web** (redirect flow)\n- `/auth/google`: Para **apps m√≥viles** (POST con idToken)",
        "tags": [
          "Auth - OAuth Web"
        ],
        "responses": {
          "200": {
            "description": "Autenticaci√≥n OAuth exitosa - Devuelve tokens JWT",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true,
                      "description": "Indica si la operaci√≥n fue exitosa"
                    },
                    "message": {
                      "type": "string",
                      "example": "Inicio de sesi√≥n exitoso con Google",
                      "description": "Mensaje descriptivo del resultado"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuthResponse",
                      "description": "Datos del usuario y tokens JWT"
                    }
                  },
                  "required": [
                    "success",
                    "message",
                    "data"
                  ]
                },
                "examples": {
                  "successful_web_login": {
                    "summary": "Login exitoso desde web",
                    "value": {
                      "success": true,
                      "message": "Inicio de sesi√≥n exitoso con Google",
                      "data": {
                        "user": {
                          "id": "cf1f1f52-43e5-462d-b15a-e6ccc3282082",
                          "nombre": "Max",
                          "apellido": "Ttito",
                          "email": "maxxd814@gmail.com",
                          "proveedorAuth": "google"
                        },
                        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmMWYxZjUyLTQzZTUtNDYyZC1iMTVhLWU2Y2NjMzI4MjA4MiIsImVtYWlsIjoibWF4eGQ4MTRAZ21haWwuY29tIiwibm9tYnJlIjoiTWF4IiwiYXBlbGxpZG8iOiJUdGl0byIsImlhdCI6MTc2MTg3MDA5NCwiZXhwIjoxNzYyNDc0ODk0fQ.example",
                        "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImNmMWYxZjUyLTQzZTUtNDYyZC1iMTVhLWU2Y2NjMzI4MjA4MiIsImVtYWlsIjoibWF4eGQ4MTRAZ21haWwuY29tIiwibm9tYnJlIjoiTWF4IiwiYXBlbGxpZG8iOiJUdGl0byIsImlhdCI6MTc2MTg3MDA5NCwiZXhwIjoxNzY0NDYyMDk0fQ.example"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Error en autenticaci√≥n OAuth - No hay datos de usuario disponibles",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "message": "Error en autenticaci√≥n OAuth"
                }
              }
            }
          },
          "500": {
            "description": "Error interno del servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/signin": {
      "get": {
        "summary": "üîó Iniciar flujo OAuth con Google (Web)",
        "description": "**SOLO PARA WEB - NO LLAMAR DESDE APPS M√ìVILES:** Este endpoint redirige al usuario a la p√°gina de autorizaci√≥n de Google. Debe ser usado desde el navegador con `window.location.href` o `window.open()`.\n\n**Uso desde Frontend Web:**\n```javascript\nwindow.open('/auth/signin?provider=google', 'googleAuth', 'width=500,height=600');\n```\n\n**NO devuelve JSON** - solo redirecciona (HTTP 302).\n\n**üì± Para apps m√≥viles:** Usar [`POST /auth/google`](src/modules/auth/router.ts ) en su lugar.",
        "tags": [
          "Auth - OAuth (Interno Web)"
        ],
        "parameters": [
          {
            "name": "provider",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "google"
              ],
              "example": "google"
            },
            "description": "Proveedor OAuth a utilizar"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirecci√≥n a la p√°gina de autorizaci√≥n de Google",
            "headers": {
              "Location": {
                "schema": {
                  "type": "string",
                  "example": "https://accounts.google.com/o/oauth2/v2/auth?..."
                },
                "description": "URL de Google OAuth"
              }
            }
          }
        }
      }
    },
    "/auth/callback/google": {
      "get": {
        "summary": "üîÑ Callback OAuth (Manejado por Auth.js)",
        "description": "**NO LLAMAR MANUALMENTE:** Google redirige aqu√≠ despu√©s de que el usuario autoriza la aplicaci√≥n. Auth.js procesa el c√≥digo de autorizaci√≥n autom√°ticamente y redirige a `/auth/oauth/success`.\n\nEste endpoint es configurado en Google Cloud Console como 'Authorized redirect URI'.",
        "tags": [
          "Auth - OAuth (Interno Web)"
        ],
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "C√≥digo de autorizaci√≥n de Google"
          },
          {
            "name": "state",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Token de estado CSRF"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirecci√≥n a /auth/oauth/success despu√©s de procesar el c√≥digo"
          },
          "401": {
            "description": "Error de autenticaci√≥n - C√≥digo inv√°lido o expirado"
          }
        }
      }
    },
    "/inicio/{userId}": {
      "get": {
        "summary": "Obtener datos de inicio del usuario",
        "description": "Obtiene los datos principales para la pantalla de inicio: √∫ltima boleta, CO2 acumulado, puntos verdes y promociones activas.",
        "tags": [
          "Inicio"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Datos de inicio obtenidos exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Datos de inicio obtenidos exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/InicioResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en el ID del usuario",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/historial/{userId}": {
      "get": {
        "summary": "Obtener historial de compras del usuario",
        "description": "Obtiene el resumen de actividad (cantidad de boletas, CO2 total y promedio) y el listado completo de compras recientes del usuario.",
        "tags": [
          "Historial"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Historial obtenido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Historial obtenido exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/HistorialResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en el ID del usuario",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/perfil/{userId}": {
      "get": {
        "summary": "Obtener perfil del usuario",
        "description": "Obtiene los datos personales del usuario (nombre, apellido, correo) y sus estad√≠sticas de compras (cantidad de recibos, recibos verdes, CO2 total y promedio).",
        "tags": [
          "Perfil"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Perfil obtenido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Perfil obtenido exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PerfilResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en el ID del usuario",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Actualizar perfil del usuario",
        "description": "Actualiza el nombre y apellido del usuario. La fecha de actualizaci√≥n se registra autom√°ticamente.",
        "tags": [
          "Perfil"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PerfilUpdateInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Perfil actualizado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Perfil actualizado exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PerfilUpdateResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en los datos enviados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/promociones": {
      "get": {
        "summary": "Obtener promociones",
        "description": "Obtiene todas las promociones activas o las promociones espec√≠ficas del usuario si se proporciona el userId. Si se incluye userId, tambi√©n retorna los puntos verdes del usuario.",
        "tags": [
          "Promociones"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "userId",
            "required": false,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID (opcional). Si se proporciona, retorna solo las promociones del usuario.",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Promociones obtenidas exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Promociones obtenidas exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PromocionesGetResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en el userId",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado (solo si se proporciona userId)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/promociones/{promocionId}/usuario/{userId}": {
      "get": {
        "summary": "Obtener detalle de promoci√≥n",
        "description": "Obtiene el detalle completo de una promoci√≥n espec√≠fica para un usuario, incluyendo disponibilidad, fecha de uso y detalles adicionales.",
        "tags": [
          "Promociones"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "promocionId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID de la promoci√≥n en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "987fcdeb-51a2-43d7-9876-ba0987654321"
          }
        ],
        "responses": {
          "200": {
            "description": "Detalle de promoci√≥n obtenido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Detalle de promoci√≥n obtenido exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/PromocionDetalle"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n en los par√°metros",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario o promoci√≥n no encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/promociones/canjear": {
      "post": {
        "summary": "Canjear promoci√≥n",
        "description": "Canjea una promoci√≥n descontando autom√°ticamente los puntos verdes requeridos del usuario. Valida que el usuario tenga suficientes puntos y que la promoci√≥n est√© activa.",
        "tags": [
          "Promociones"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CanjearPromocionInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Promoci√≥n canjeada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Promoci√≥n canjeada exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CanjearPromocionResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n o puntos insuficientes",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse",
                  "example": {
                    "success": false,
                    "message": "Puntos insuficientes. Necesitas 100 puntos y tienes 50"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Usuario o promoci√≥n no encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/boletas/{userId}/upload": {
      "post": {
        "summary": "Subir y procesar una boleta",
        "description": "Procesa una imagen de boleta mediante OCR, detecta el supermercado, clasifica productos, calcula impacto ambiental y genera sugerencias ecol√≥gicas. Actualiza puntos verdes si es recibo verde.",
        "tags": [
          "Boletas"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID del usuario en formato UUID",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "boleta": {
                    "type": "string",
                    "format": "binary",
                    "description": "Archivo de imagen de la boleta (JPEG, PNG o PDF, m√°ximo 10MB)"
                  }
                },
                "required": [
                  "boleta"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Boleta procesada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Boleta procesada exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ProcesarBoletaResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validaci√≥n (archivo no v√°lido o sin productos detectados)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "sinArchivo": {
                    "summary": "No se subi√≥ archivo",
                    "value": {
                      "success": false,
                      "message": "No se ha subido ninguna imagen"
                    }
                  },
                  "sinProductos": {
                    "summary": "No se detectaron productos",
                    "value": {
                      "success": false,
                      "message": "No se detectaron productos en la imagen"
                    }
                  },
                  "tipoInvalido": {
                    "summary": "Tipo de archivo no permitido",
                    "value": {
                      "success": false,
                      "message": "Tipo de archivo no permitido. Solo JPEG, PNG o PDF"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Usuario no autenticado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/boletas/{boletaId}": {
      "get": {
        "summary": "Obtener detalle de una boleta procesada",
        "description": "Retorna la informaci√≥n completa de una boleta previamente procesada, incluyendo productos, an√°lisis de impacto ambiental y datos de la tienda.",
        "tags": [
          "Boletas"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "boletaId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID de la boleta en formato UUID",
            "example": "a3f2c1e0-b4d5-4321-8765-1234567890ab"
          }
        ],
        "responses": {
          "200": {
            "description": "Detalle de boleta obtenido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Detalle de boleta obtenido exitosamente"
                    },
                    "data": {
                      "$ref": "#/components/schemas/DetalleBoletaResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Usuario no autenticado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Boleta no encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "message": "Boleta no encontrada"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object"
          }
        },
        "required": [
          "success",
          "message"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "example": "Error message"
          }
        },
        "required": [
          "success",
          "message"
        ]
      },
      "TestEchoInput": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "example": "Hello World"
          }
        },
        "required": [
          "message"
        ]
      },
      "TestEchoResponse": {
        "type": "object",
        "properties": {
          "received": {
            "type": "string",
            "example": "Hello World"
          },
          "timestamp": {
            "type": "string",
            "example": "2024-01-20T10:30:00Z"
          }
        }
      },
      "AuthRegisterInput": {
        "type": "object",
        "properties": {
          "nombre": {
            "type": "string",
            "example": "Juan",
            "minLength": 3
          },
          "apellido": {
            "type": "string",
            "example": "Perez",
            "minLength": 3
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "juan.perez@example.com"
          },
          "password": {
            "type": "string",
            "format": "password",
            "minLength": 6,
            "example": "password123"
          }
        },
        "required": [
          "nombre",
          "apellido",
          "email",
          "password"
        ]
      },
      "AuthLoginInput": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "example": "juan.perez@example.com"
          },
          "password": {
            "type": "string",
            "format": "password",
            "example": "password123"
          }
        },
        "required": [
          "email",
          "password"
        ]
      },
      "GoogleLoginInput": {
        "type": "object",
        "description": "Esquema para autenticaci√≥n con Google desde aplicaciones m√≥viles",
        "properties": {
          "idToken": {
            "type": "string",
            "description": "Token JWT firmado por Google obtenido del Google Sign-In SDK (Android/iOS). NO confundir con Client ID.",
            "example": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjU5MmU0YmZlN2RkYWFmMGNmZjRhMTJhMjk0ODFkZjJlOGQ2MTU0YzMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiI4MDgyOTc5NTgyLTk0MzA5OGJvYWhhZzc5dXZxNzM3ZWY5dmJyNWc1aWE4LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiODA4Mjk3OTU4Mi05NDMwOThib2FoYWc3OXV2cTczN2VmOXZicjVnNWlhOC5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwNzk2NDIzNDgyMTk0NjE1MTU5MiIsImVtYWlsIjoiZXhhbXBsZUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkpvaG4gRG9lIiwicGljdHVyZSI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hLS9BT2gxNEdnNl9fVGdQQV96QVlyYy1zSDFXT2h4N2V0eHN4elRlY1p0VjlaRT1zOTYtYyIsImdpdmVuX25hbWUiOiJKb2huIiwiZmFtaWx5X25hbWUiOiJEb2UiLCJsb2NhbGUiOiJlbiIsImlhdCI6MTcxNjIzOTAyMiwiZXhwIjoxNzE2MjQyNjIyfQ.example_signature"
          }
        },
        "required": [
          "idToken"
        ]
      },
      "AuthUser": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "cf1f1f52-43e5-462d-b15a-e6ccc3282082"
          },
          "nombre": {
            "type": "string",
            "example": "Max"
          },
          "apellido": {
            "type": "string",
            "example": "Ttito"
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "maxxd814@gmail.com"
          },
          "proveedorAuth": {
            "type": "string",
            "example": "google",
            "description": "Proveedor de autenticaci√≥n (google, email, etc.)"
          }
        },
        "required": [
          "id",
          "nombre",
          "apellido",
          "email"
        ]
      },
      "AuthResponse": {
        "type": "object",
        "description": "Respuesta est√°ndar de autenticaci√≥n - Usado para login tradicional, OAuth web y OAuth m√≥vil",
        "properties": {
          "user": {
            "$ref": "#/components/schemas/AuthUser"
          },
          "token": {
            "type": "string",
            "description": "JWT access token (v√°lido por 7 d√≠as)",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          },
          "refreshToken": {
            "type": "string",
            "description": "JWT refresh token (v√°lido por 30 d√≠as)",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          }
        },
        "required": [
          "user",
          "token",
          "refreshToken"
        ]
      },
      "AuthRefreshTokenInput": {
        "type": "object",
        "properties": {
          "refreshToken": {
            "type": "string",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          }
        },
        "required": [
          "refreshToken"
        ]
      },
      "InicioUltimaBoleta": {
        "type": "object",
        "nullable": true,
        "properties": {
          "nombreTienda": {
            "type": "string",
            "nullable": true,
            "example": "Supermercado L√≠der"
          },
          "categoriaTienda": {
            "type": "string",
            "nullable": true,
            "example": "Supermercados"
          },
          "logoTienda": {
            "type": "string",
            "nullable": true,
            "format": "uri",
            "example": "https://example.com/logos/lider.png"
          },
          "co2Total": {
            "type": "number",
            "format": "float",
            "example": 12.5,
            "description": "Total de CO2 de la boleta en kg"
          },
          "fechaBoleta": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "example": "2024-01-15T14:30:00Z"
          },
          "precioTotal": {
            "type": "number",
            "format": "float",
            "nullable": true,
            "example": 45990.5,
            "description": "Precio total de la boleta"
          }
        }
      },
      "InicioPromocion": {
        "type": "object",
        "properties": {
          "titulo": {
            "type": "string",
            "example": "20% de descuento en productos sustentables"
          },
          "tipoPromocion": {
            "type": "string",
            "example": "Descuento"
          }
        },
        "required": [
          "titulo",
          "tipoPromocion"
        ]
      },
      "InicioResponse": {
        "type": "object",
        "properties": {
          "puntosVerdes": {
            "type": "number",
            "format": "int32",
            "example": 850,
            "description": "Puntos verdes acumulados del usuario"
          },
          "co2Acumulado": {
            "type": "number",
            "format": "float",
            "example": 125.75,
            "description": "Total de CO2 acumulado de todas las boletas del usuario en kg"
          },
          "ultimaBoleta": {
            "$ref": "#/components/schemas/InicioUltimaBoleta",
            "description": "Datos de la √∫ltima boleta del usuario"
          },
          "promociones": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InicioPromocion"
            },
            "maxItems": 2,
            "description": "Las 2 promociones m√°s recientes que est√°n activas"
          }
        },
        "required": [
          "puntosVerdes",
          "co2Acumulado",
          "ultimaBoleta",
          "promociones"
        ]
      },
      "HistorialResumenActividad": {
        "type": "object",
        "properties": {
          "cantidadBoletas": {
            "type": "integer",
            "format": "int32",
            "example": 24,
            "description": "Total de boletas del usuario"
          },
          "cantidadBoletasVerdes": {
            "type": "integer",
            "format": "int32",
            "example": 15,
            "description": "Cantidad de boletas con tipo ambiental VERDE"
          },
          "cantidadBoletasAmarillas": {
            "type": "integer",
            "format": "int32",
            "example": 7,
            "description": "Cantidad de boletas con tipo ambiental AMARILLO"
          },
          "cantidadBoletasRojas": {
            "type": "integer",
            "format": "int32",
            "example": 2,
            "description": "Cantidad de boletas con tipo ambiental ROJO"
          },
          "co2Total": {
            "type": "number",
            "format": "float",
            "example": 125.75,
            "description": "Total de CO2 acumulado de todas las boletas en kg"
          },
          "co2Promedio": {
            "type": "number",
            "format": "float",
            "example": 5.24,
            "description": "Promedio de CO2 por boleta en kg"
          }
        },
        "required": [
          "cantidadBoletas",
          "cantidadBoletasVerdes",
          "cantidadBoletasAmarillas",
          "cantidadBoletasRojas",
          "co2Total",
          "co2Promedio"
        ]
      },
      "HistorialCompraReciente": {
        "type": "object",
        "properties": {
          "fechaBoleta": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "example": "2024-01-15T14:30:00Z",
            "description": "Fecha de la compra"
          },
          "logoTienda": {
            "type": "string",
            "format": "uri",
            "nullable": true,
            "example": "https://example.com/logos/lider.png",
            "description": "URL del logo de la tienda"
          },
          "nombreTienda": {
            "type": "string",
            "nullable": true,
            "example": "Supermercado L√≠der",
            "description": "Nombre de la tienda"
          },
          "tipoBoleta": {
            "type": "string",
            "enum": [
              "VERDE",
              "AMARILLO",
              "ROJO"
            ],
            "example": "VERDE",
            "description": "Tipo de boleta seg√∫n impacto ambiental"
          },
          "co2Boleta": {
            "type": "number",
            "format": "float",
            "example": 4.5,
            "description": "CO2 total de esta boleta espec√≠fica en kg"
          },
          "cantidadProductos": {
            "type": "integer",
            "format": "int32",
            "example": 12,
            "description": "N√∫mero de productos en la boleta"
          }
        },
        "required": [
          "fechaBoleta",
          "logoTienda",
          "nombreTienda",
          "tipoBoleta",
          "co2Boleta",
          "cantidadProductos"
        ]
      },
      "HistorialResponse": {
        "type": "object",
        "properties": {
          "resumenActividad": {
            "$ref": "#/components/schemas/HistorialResumenActividad",
            "description": "Resumen estad√≠stico de la actividad del usuario"
          },
          "comprasRecientes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/HistorialCompraReciente"
            },
            "description": "Listado completo de todas las compras del usuario ordenadas por fecha descendente"
          }
        },
        "required": [
          "resumenActividad",
          "comprasRecientes"
        ]
      },
      "PerfilDatosUsuario": {
        "type": "object",
        "properties": {
          "nombre": {
            "type": "string",
            "example": "Juan",
            "description": "Nombre del usuario"
          },
          "apellido": {
            "type": "string",
            "example": "P√©rez",
            "description": "Apellido del usuario"
          },
          "correo": {
            "type": "string",
            "format": "email",
            "example": "juan.perez@example.com",
            "description": "Correo electr√≥nico del usuario"
          }
        },
        "required": [
          "nombre",
          "apellido",
          "correo"
        ]
      },
      "PerfilEstadisticas": {
        "type": "object",
        "properties": {
          "cantidadRecibos": {
            "type": "integer",
            "format": "int32",
            "example": 24,
            "description": "Total de recibos del usuario"
          },
          "cantidadRecibosVerdes": {
            "type": "integer",
            "format": "int32",
            "example": 15,
            "description": "Cantidad de recibos con tipo ambiental VERDE"
          },
          "co2Total": {
            "type": "number",
            "format": "float",
            "example": 125.75,
            "description": "Total de CO2 acumulado de todos los recibos en kg"
          },
          "co2Promedio": {
            "type": "number",
            "format": "float",
            "example": 5.24,
            "description": "Promedio de CO2 por recibo en kg"
          }
        },
        "required": [
          "cantidadRecibos",
          "cantidadRecibosVerdes",
          "co2Total",
          "co2Promedio"
        ]
      },
      "PerfilResponse": {
        "type": "object",
        "properties": {
          "datosUsuario": {
            "$ref": "#/components/schemas/PerfilDatosUsuario",
            "description": "Informaci√≥n personal del usuario"
          },
          "estadisticas": {
            "$ref": "#/components/schemas/PerfilEstadisticas",
            "description": "Estad√≠sticas de compras del usuario"
          }
        },
        "required": [
          "datosUsuario",
          "estadisticas"
        ]
      },
      "PerfilUpdateInput": {
        "type": "object",
        "properties": {
          "nombre": {
            "type": "string",
            "minLength": 3,
            "maxLength": 80,
            "example": "Juan Carlos",
            "description": "Nuevo nombre del usuario"
          },
          "apellido": {
            "type": "string",
            "minLength": 3,
            "maxLength": 80,
            "example": "P√©rez Garc√≠a",
            "description": "Nuevo apellido del usuario"
          }
        },
        "required": [
          "nombre",
          "apellido"
        ]
      },
      "PerfilUpdateResponse": {
        "type": "object",
        "properties": {
          "nombre": {
            "type": "string",
            "example": "Juan Carlos",
            "description": "Nombre actualizado"
          },
          "apellido": {
            "type": "string",
            "example": "P√©rez Garc√≠a",
            "description": "Apellido actualizado"
          },
          "actualizadoEn": {
            "type": "string",
            "format": "date-time",
            "example": "2024-01-15T14:30:00Z",
            "description": "Fecha y hora de la √∫ltima actualizaci√≥n"
          }
        },
        "required": [
          "nombre",
          "apellido",
          "actualizadoEn"
        ]
      },
      "PromocionItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "123e4567-e89b-12d3-a456-426614174000",
            "description": "ID √∫nico de la promoci√≥n"
          },
          "titulo": {
            "type": "string",
            "example": "20% de descuento en productos sustentables",
            "description": "T√≠tulo de la promoci√≥n"
          },
          "descripcion": {
            "type": "string",
            "nullable": true,
            "example": "Obt√©n un 20% de descuento en todos los productos con certificaci√≥n ecol√≥gica",
            "description": "Descripci√≥n detallada de la promoci√≥n"
          },
          "tipoPromocion": {
            "type": "string",
            "example": "Descuento",
            "description": "Tipo de promoci√≥n (Descuento, Puntos, Cup√≥n, etc.)"
          },
          "boletasRequeridas": {
            "type": "integer",
            "format": "int32",
            "example": 50,
            "description": "Cantidad de puntos (boletas verdes) requeridos para canjear"
          },
          "validezInicio": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "example": "2024-01-01T00:00:00Z",
            "description": "Fecha de inicio de validez de la promoci√≥n"
          },
          "validezFin": {
            "type": "string",
            "format": "date-time",
            "nullable": true,
            "example": "2024-12-31T23:59:59Z",
            "description": "Fecha de fin de validez de la promoci√≥n"
          },
          "activa": {
            "type": "boolean",
            "example": true,
            "description": "Indica si la promoci√≥n est√° activa"
          },
          "tienda": {
            "type": "object",
            "nullable": true,
            "properties": {
              "nombre": {
                "type": "string",
                "example": "Wong",
                "description": "Nombre de la tienda asociada"
              },
              "urlLogo": {
                "type": "string",
                "format": "uri",
                "nullable": true,
                "example": "https://example.com/logos/wong.png",
                "description": "URL del logo de la tienda"
              }
            },
            "description": "Informaci√≥n de la tienda asociada a la promoci√≥n"
          }
        },
        "required": [
          "id",
          "titulo",
          "tipoPromocion",
          "boletasRequeridas",
          "activa"
        ]
      },
      "PromocionDetalle": {
        "allOf": [
          {
            "$ref": "#/components/schemas/PromocionItem"
          },
          {
            "type": "object",
            "properties": {
              "disponible": {
                "type": "boolean",
                "example": true,
                "description": "Indica si el usuario ya canje√≥ esta promoci√≥n (true = ya canjeada)"
              },
              "fechaUso": {
                "type": "string",
                "format": "date-time",
                "nullable": true,
                "example": "2024-01-20T10:30:00Z",
                "description": "Fecha en la que el usuario us√≥ la promoci√≥n"
              },
              "detalles": {
                "type": "string",
                "nullable": true,
                "example": "C√≥digo de descuento: VERDE20",
                "description": "Detalles adicionales de la promoci√≥n canjeada"
              }
            },
            "required": [
              "disponible",
              "fechaUso",
              "detalles"
            ]
          }
        ]
      },
      "PromocionesGetResponse": {
        "type": "object",
        "properties": {
          "puntosUsuario": {
            "type": "integer",
            "format": "int32",
            "example": 150,
            "description": "Puntos verdes del usuario (solo si se proporciona userId)"
          },
          "promociones": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PromocionItem"
            },
            "description": "Lista de promociones activas o del usuario"
          }
        },
        "required": [
          "promociones"
        ]
      },
      "CanjearPromocionInput": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "format": "uuid",
            "example": "123e4567-e89b-12d3-a456-426614174000",
            "description": "ID del usuario que canjea la promoci√≥n"
          },
          "promocionId": {
            "type": "string",
            "format": "uuid",
            "example": "987fcdeb-51a2-43d7-9876-ba0987654321",
            "description": "ID de la promoci√≥n a canjear"
          }
        },
        "required": [
          "userId",
          "promocionId"
        ]
      },
      "CanjearPromocionResponse": {
        "type": "object",
        "properties": {
          "promocionUsuarioId": {
            "type": "string",
            "format": "uuid",
            "example": "abc12345-6789-def0-1234-567890abcdef",
            "description": "ID del registro del canje en PromocionesUsuarios"
          },
          "puntosRestantes": {
            "type": "integer",
            "format": "int32",
            "example": 100,
            "description": "Puntos verdes restantes del usuario despu√©s del canje"
          },
          "fechaCanje": {
            "type": "string",
            "format": "date-time",
            "example": "2024-01-25T15:45:00Z",
            "description": "Fecha y hora del canje"
          }
        },
        "required": [
          "promocionUsuarioId",
          "puntosRestantes",
          "fechaCanje"
        ]
      },
      "ProductoClasificado": {
        "type": "object",
        "properties": {
          "nombre": {
            "type": "string",
            "example": "Leche Gloria Entera 1L",
            "description": "Nombre del producto identificado"
          },
          "precio": {
            "type": "number",
            "format": "float",
            "example": 3.5,
            "description": "Precio unitario del producto"
          },
          "cantidad": {
            "type": "integer",
            "format": "int32",
            "example": 1,
            "description": "Cantidad de unidades compradas"
          },
          "categoria": {
            "type": "string",
            "example": "L√°cteos y Frescos",
            "description": "Categor√≠a normalizada del producto"
          },
          "subcategoria": {
            "type": "string",
            "nullable": true,
            "example": "Leches",
            "description": "Subcategor√≠a del producto (opcional)"
          },
          "marcaId": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "example": "789e4567-e89b-12d3-a456-426614174003",
            "description": "ID de la marca del producto (opcional)"
          },
          "factorCo2": {
            "type": "number",
            "format": "float",
            "example": 2.5,
            "description": "Factor de CO2 del producto en kg CO2e"
          },
          "esLocal": {
            "type": "boolean",
            "example": false,
            "description": "Indica si el producto es de origen local"
          },
          "tieneEmpaqueEcologico": {
            "type": "boolean",
            "example": false,
            "description": "Indica si el producto tiene empaque ecol√≥gico"
          },
          "confianza": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1,
            "example": 0.89,
            "description": "Nivel de confianza de la clasificaci√≥n (0-1)"
          }
        },
        "required": [
          "nombre",
          "precio",
          "cantidad",
          "categoria",
          "factorCo2",
          "esLocal",
          "tieneEmpaqueEcologico",
          "confianza"
        ]
      },
      "ProductoDetalle": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "prod-uuid-123",
            "description": "ID √∫nico del producto en la base de datos"
          },
          "nombre": {
            "type": "string",
            "nullable": true,
            "example": "Leche Gloria Entera 1L",
            "description": "Nombre del producto"
          },
          "cantidad": {
            "type": "number",
            "format": "float",
            "example": 2,
            "description": "Cantidad de unidades compradas"
          },
          "precioUnitario": {
            "type": "number",
            "format": "float",
            "example": 3.5,
            "description": "Precio por unidad del producto"
          },
          "precioTotal": {
            "type": "number",
            "format": "float",
            "example": 7,
            "description": "Precio total (cantidad √ó precio unitario)"
          },
          "factorCo2": {
            "type": "number",
            "format": "float",
            "example": 2.5,
            "description": "Factor de CO2 del producto en kg CO2e por unidad"
          },
          "categoria": {
            "type": "string",
            "nullable": true,
            "example": "L√°cteos y Frescos",
            "description": "Categor√≠a del producto"
          },
          "subcategoria": {
            "type": "string",
            "nullable": true,
            "example": "Leches",
            "description": "Subcategor√≠a del producto"
          },
          "marca": {
            "type": "string",
            "nullable": true,
            "example": "Gloria",
            "description": "Nombre de la marca del producto"
          }
        },
        "required": [
          "id",
          "nombre",
          "cantidad",
          "precioUnitario",
          "precioTotal",
          "factorCo2",
          "categoria",
          "subcategoria",
          "marca"
        ]
      },
      "AnalisisBoleta": {
        "type": "object",
        "properties": {
          "totalProductos": {
            "type": "integer",
            "format": "int32",
            "example": 12,
            "description": "Total de productos en la boleta"
          },
          "productosVerdes": {
            "type": "integer",
            "format": "int32",
            "example": 8,
            "description": "Cantidad de productos clasificados como ecol√≥gicos"
          },
          "porcentajeVerde": {
            "type": "number",
            "format": "int32",
            "minimum": 0,
            "maximum": 100,
            "example": 67,
            "description": "Porcentaje de productos verdes sobre el total"
          },
          "co2Total": {
            "type": "number",
            "format": "float",
            "example": 45.75,
            "description": "Total de CO2 de todos los productos en kg"
          },
          "co2Promedio": {
            "type": "number",
            "format": "float",
            "example": 3.81,
            "description": "Promedio de CO2 por producto en kg"
          },
          "tipoAmbiental": {
            "type": "string",
            "enum": [
              "VERDE",
              "AMARILLO",
              "ROJO"
            ],
            "example": "VERDE",
            "description": "Clasificaci√≥n ambiental de la boleta. VERDE: ‚â•60% productos verdes y CO2 promedio <4.0. AMARILLO: ‚â•30% productos verdes y CO2 promedio <7.0. ROJO: resto de casos"
          },
          "esReciboVerde": {
            "type": "boolean",
            "example": true,
            "description": "Indica si la boleta califica como recibo verde (otorga +1 punto verde al usuario)"
          }
        },
        "required": [
          "totalProductos",
          "productosVerdes",
          "porcentajeVerde",
          "co2Total",
          "co2Promedio",
          "tipoAmbiental",
          "esReciboVerde"
        ]
      },
      "AnalisisDetalleSimplificado": {
        "type": "object",
        "properties": {
          "totalProductos": {
            "type": "integer",
            "format": "int32",
            "example": 5,
            "description": "Cantidad total de productos en la boleta"
          },
          "co2Total": {
            "type": "number",
            "format": "float",
            "example": 23.45,
            "description": "Total de CO2 de todos los productos en kg"
          },
          "co2Promedio": {
            "type": "number",
            "format": "float",
            "example": 4.69,
            "description": "Promedio de CO2 por producto en kg"
          }
        },
        "required": [
          "totalProductos",
          "co2Total",
          "co2Promedio"
        ]
      },
      "DetalleBoletaResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "a3f2c1e0-b4d5-4321-8765-1234567890ab",
            "description": "ID √∫nico de la boleta"
          },
          "fechaBoleta": {
            "type": "string",
            "format": "date",
            "nullable": true,
            "example": "2025-01-05",
            "description": "Fecha de emisi√≥n de la boleta"
          },
          "nombreTienda": {
            "type": "string",
            "nullable": true,
            "example": "Tottus",
            "description": "Nombre de la tienda donde se realiz√≥ la compra"
          },
          "logoTienda": {
            "type": "string",
            "nullable": true,
            "example": "https://example.com/tottus-logo.png",
            "description": "URL del logo de la tienda"
          },
          "total": {
            "type": "number",
            "format": "float",
            "example": 34.7,
            "description": "Monto total de la boleta en soles (PEN)"
          },
          "tipoAmbiental": {
            "type": "string",
            "enum": [
              "VERDE",
              "AMARILLO",
              "ROJO"
            ],
            "example": "VERDE",
            "description": "Clasificaci√≥n ambiental de la boleta seg√∫n el impacto de los productos"
          },
          "urlImagen": {
            "type": "string",
            "nullable": true,
            "example": "boleta_2025_01_05.jpg",
            "description": "Nombre del archivo de imagen de la boleta original"
          },
          "productos": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductoDetalle"
            },
            "description": "Listado de productos comprados en la boleta"
          },
          "analisis": {
            "$ref": "#/components/schemas/AnalisisDetalleSimplificado",
            "description": "An√°lisis simplificado del impacto ambiental de la boleta"
          }
        },
        "required": [
          "id",
          "fechaBoleta",
          "nombreTienda",
          "logoTienda",
          "total",
          "tipoAmbiental",
          "urlImagen",
          "productos",
          "analisis"
        ]
      },
      "ProcesarBoletaResponse": {
        "type": "object",
        "properties": {
          "boletaId": {
            "type": "string",
            "format": "uuid",
            "example": "a3f2c1e0-b4d5-4321-8765-1234567890ab",
            "description": "ID √∫nico de la boleta procesada y guardada en BD"
          },
          "analisis": {
            "$ref": "#/components/schemas/AnalisisBoleta",
            "description": "An√°lisis del impacto ambiental de la boleta"
          },
          "productos": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProductoClasificado"
            },
            "description": "Listado de productos extra√≠dos y clasificados de la boleta"
          },
          "sugerencias": {
            "type": "array",
            "items": {
              "type": "string",
              "example": "Prioriza productos locales y de temporada"
            },
            "description": "Sugerencias ecol√≥gicas personalizadas generadas por IA",
            "minItems": 3,
            "maxItems": 3
          }
        },
        "required": [
          "boletaId",
          "analisis",
          "productos",
          "sugerencias"
        ]
      }
    }
  },
  "tags": [
    {
      "name": "Test",
      "description": "Endpoints de prueba"
    },
    {
      "name": "Auth - Tradicional",
      "description": "Autenticaci√≥n con email y contrase√±a. Devuelve tokens JWT."
    },
    {
      "name": "Auth - OAuth M√≥vil",
      "description": "üÜï **NUEVO:** `POST /auth/google` - Endpoint para apps m√≥viles (Android/iOS). Recibe idToken de Google SDK y devuelve JWT."
    },
    {
      "name": "Auth - OAuth Web",
      "description": "üåê `GET /auth/oauth/success` - Endpoint para navegador web. Devuelve JSON con tokens despu√©s de redirect flow."
    },
    {
      "name": "Auth - OAuth (Interno Web)",
      "description": "‚öôÔ∏è Endpoints manejados autom√°ticamente por Auth.js para web. NO llamar directamente - solo redireccionan."
    },
    {
      "name": "Inicio",
      "description": "Endpoints para obtener datos de la pantalla de inicio del usuario"
    },
    {
      "name": "Historial",
      "description": "Endpoints para obtener el historial completo de compras y estad√≠sticas del usuario"
    },
    {
      "name": "Perfil",
      "description": "Endpoints para gestionar el perfil del usuario y visualizar sus estad√≠sticas"
    },
    {
      "name": "Promociones",
      "description": "Endpoints para gestionar promociones: consultar, ver detalles y canjear con puntos verdes"
    },
    {
      "name": "Boletas",
      "description": "Endpoints para procesar boletas de compra: extracci√≥n OCR, clasificaci√≥n de productos, an√°lisis de impacto ambiental y generaci√≥n de sugerencias ecol√≥gicas"
    }
  ]
}